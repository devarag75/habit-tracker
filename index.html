<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Monthly Habit Tracker Pro</title>

<style>
:root {
  --bg: #eef2ff;
  --card: rgba(255,255,255,0.9);
  --text: #111;
  --grid: #ddd;
  --accent: #6366f1;
}

body.dark {
  --bg: #0f172a;
  --card: #111827;
  --text: #e5e7eb;
  --grid: #374151;
  --accent: #22d3ee;
}

body {
  margin: 0;
  font-family: system-ui, sans-serif;
  background: linear-gradient(135deg, var(--bg), #f8fafc);
  color: var(--text);
}

.app { padding: 18px; }

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.badge {
  background: #22c55e;
  color: white;
  padding: 6px 10px;
  border-radius: 999px;
  font-size: 12px;
}

button {
  cursor: pointer;
}

.layout {
  display: grid;
  grid-template-columns: 62% 38%;
  gap: 14px;
}

.card {
  background: var(--card);
  border-radius: 14px;
  padding: 12px;
  box-shadow: 0 8px 22px rgba(0,0,0,.15);
}

table {
  width: 100%;
  border-collapse: collapse;
  font-size: 11px;
}

th, td {
  border: 1px solid var(--grid);
  padding: 4px;
  text-align: center;
}

td.done { background: #22c55e; color: white; }
td.missed { background: #7f1d1d; color: #fecaca; }
td.today { outline: 2px solid var(--accent); }

.spark {
  width: 60px;
  height: 18px;
}

.toggle {
  background: var(--accent);
  color: white;
  border: none;
  padding: 6px 10px;
  border-radius: 8px;
}
canvas { width: 100%; height: 300px; }
</style>
</head>

<body>
<div class="app">

<div class="header">
  <h2>üìò Monthly Habit Tracker</h2>
  <div>
    <button class="toggle" onclick="toggleTheme()">üåô</button>
    <span class="badge" id="percent">0%</span>
  </div>
</div>

<div class="layout">
<div class="card">
  <table id="grid"></table>
</div>

<div class="card">
  <canvas id="graph"></canvas>
</div>
</div>

</div>

<script>
const DAYS = 31;
const STORAGE = "habit_tracker_final";

let state = JSON.parse(localStorage.getItem(STORAGE)) || {
  dark: false,
  habits: ["Wake up early","Study","Coding","Exercise","No gaming"],
  data: {}
};

document.body.classList.toggle("dark", state.dark);

const grid = document.getElementById("grid");
const graph = document.getElementById("graph").getContext("2d");
const percent = document.getElementById("percent");

function save(){ localStorage.setItem(STORAGE, JSON.stringify(state)); }

function toggleTheme(){
  state.dark = !state.dark;
  document.body.classList.toggle("dark", state.dark);
  save();
}

function build(){
  const m = new Date().toISOString().slice(0,7);
  state.data[m] ||= {};
  const today = new Date().getDate();

  let html = `<tr><th>Habit</th><th>üìà</th>`;
  for(let d=1;d<=DAYS;d++) html+=`<th>${d}</th>`;
  html+="</tr>";

  state.habits.forEach(h=>{
    html+=`<tr><th>${h}</th><td><canvas class="spark" id="s_${h}"></canvas></td>`;
    for(let d=1;d<=DAYS;d++){
      const k=h+"_"+d, v=state.data[m][k];
      const past=d<today;
      html+=`<td class="${v?'done':past?'missed':''}" 
      ${!past?`onclick="toggle('${h}',${d})"`:''}>${v?'‚úî':past?'‚ùå':''}</td>`;
    }
    html+="</tr>";
  });

  grid.innerHTML=html;
  drawMain();
  state.habits.forEach(drawSpark);
  updatePercent();
}

function toggle(h,d){
  const m=new Date().toISOString().slice(0,7);
  const k=h+"_"+d;
  state.data[m][k]=!state.data[m][k];
  save(); build();
}

function drawMain(){
  graph.clearRect(0,0,600,300);
  graph.beginPath();
  graph.strokeStyle=getComputedStyle(document.body).getPropertyValue("--accent");
  graph.lineWidth=1.2;
  for(let d=1;d<=DAYS;d++){
    let v=0;
    state.habits.forEach(h=>{
      if(state.data[new Date().toISOString().slice(0,7)][h+"_"+d])v++;
    });
    const x=(d/DAYS)*600;
    const y=300-v*25;
    d===1?graph.moveTo(x,y):graph.lineTo(x,y);
  }
  graph.stroke();
}

function drawSpark(h){
  const c=document.getElementById("s_"+h).getContext("2d");
  c.clearRect(0,0,60,18);
  c.beginPath();
  c.strokeStyle="#22c55e";
  c.lineWidth=1;
  for(let d=1;d<=DAYS;d++){
    const v=state.data[new Date().toISOString().slice(0,7)][h+"_"+d];
    const x=(d/DAYS)*60;
    const y=v?5:15;
    d===1?c.moveTo(x,y):c.lineTo(x,y);
  }
  c.stroke();
}

function updatePercent(){
  const m=new Date().toISOString().slice(0,7);
  let t=DAYS*state.habits.length,d=0;
  Object.values(state.data[m]).forEach(v=>v&&d++);
  percent.textContent=Math.round((d/t)*100)+"%";
}

build();
</script>
</body>
</html>
